<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Linear Regression | ISLR tidymodels Labs</title>
<meta name="author" content="Emil Hvitfeldt">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.8/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ISLR tidymodels Labs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="statistical-learning.html"><span class="header-section-number">2</span> Statistical learning</a></li>
<li><a class="active" href="linear-regression.html"><span class="header-section-number">3</span> Linear Regression</a></li>
<li><a class="" href="classification.html"><span class="header-section-number">4</span> Classification</a></li>
<li><a class="" href="resampling-methods.html"><span class="header-section-number">5</span> Resampling Methods</a></li>
<li><a class="" href="linear-model-selection-and-regularization.html"><span class="header-section-number">6</span> Linear Model Selection and Regularization</a></li>
<li><a class="" href="moving-beyond-linearity.html"><span class="header-section-number">7</span> Moving Beyond Linearity</a></li>
<li><a class="" href="tree-based-methods.html"><span class="header-section-number">8</span> Tree-Based Methods</a></li>
<li><a class="" href="support-vector-machines.html"><span class="header-section-number">9</span> Support Vector Machines</a></li>
<li><a class="" href="unsupervised-learning.html"><span class="header-section-number">10</span> Unsupervised Learning</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="linear-regression" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Linear Regression<a class="anchor" aria-label="anchor" href="#linear-regression"><i class="fas fa-link"></i></a>
</h1>
<p>This lab will go over how to perform linear regression. This will include <a href="linear-regression.html#simple-linear-regression">simple linear regression</a> and <a href="linear-regression.html#multiple-linear-regression">multiple linear regression</a> in addition to how you can apply transformations to the predictors. This chapter will use <a href="https://www.tidymodels.org/start/models/">parsnip</a> for model fitting and <a href="https://www.tidymodels.org/start/recipes/">recipes and workflows</a> to perform the transformations.</p>
<div id="libraries" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Libraries<a class="anchor" aria-label="anchor" href="#libraries"><i class="fas fa-link"></i></a>
</h2>
<p>We load tidymodels and ISLR and MASS for data sets.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span> <span class="co"># For Boston data set</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.StatLearning.com">ISLR</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="simple-linear-regression" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Simple linear regression<a class="anchor" aria-label="anchor" href="#simple-linear-regression"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>Boston</code> data set contain various statistics for 506 neighborhoods in Boston. We will build a simple linear regression model that related the median value of owner-occupied homes (<code>medv</code>) as the response with a variable indicating the percentage of the population that belongs to a lower status (<code>lstat</code>) as the predictor.</p>
<div class="infobox">
<p>
The <code>Boston</code> data set is quite outdated and contains some really unfortunate variables.
</p>
</div>
<p>We start by creating a parsnip specification for a linear regression model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_spec</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></code></pre></div>
<p>While it is unnecessary to set the mode for a linear regression since it can only be regression, we continue to do it in these labs to be explicit.</p>
<p>The specification doesn’t perform any calculations by itself. It is just a specification of what we want to do.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_spec</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Computational engine: lm</code></pre>
<p>Once we have the specification we can <code>fit</code> it by supplying a formula expression and the data we want to fit the model on.
The formula is written on the form <code>y ~ x</code> where <code>y</code> is the name of the response and <code>x</code> is the name of the predictors.
The names used in the formula should match the names of the variables in the data set passed to <code>data</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="va">lm_spec</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span>

<span class="va">lm_fit</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  3ms 
## 
## Call:
## stats::lm(formula = medv ~ lstat, data = data)
## 
## Coefficients:
## (Intercept)        lstat  
##       34.55        -0.95</code></pre>
<p>The result of this fit is a parsnip model object. This object contains the underlying fit as well as some parsnip-specific information. If we want to look at the underlying fit object we can access it with <code>lm_fit$fit</code> or with</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">pluck</span><span class="op">(</span><span class="st">"fit"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = medv ~ lstat, data = data)
## 
## Coefficients:
## (Intercept)        lstat  
##       34.55        -0.95</code></pre>
<p>The <code>lm</code> object has a nice <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method that shows more information about the fit, including parameter estimates and lack-of-fit statistics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">pluck</span><span class="op">(</span><span class="st">"fit"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = medv ~ lstat, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.168  -3.990  -1.318   2.034  24.500 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 34.55384    0.56263   61.41   &lt;2e-16 ***
## lstat       -0.95005    0.03873  -24.53   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.216 on 504 degrees of freedom
## Multiple R-squared:  0.5441, Adjusted R-squared:  0.5432 
## F-statistic: 601.6 on 1 and 504 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We can use packages from the <a href="https://broom.tidymodels.org/">broom</a> package to extract key information out of the model objects in tidy formats.</p>
<p>the <code>tidy()</code> function returns the parameter estimates of a <code>lm</code> object</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tidy</span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   34.6      0.563       61.4 3.74e-236
## 2 lstat         -0.950    0.0387     -24.5 5.08e- 88</code></pre>
<p>and <code>glance()</code> can be used to extract the model statistics.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glance</span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.544         0.543  6.22      602. 5.08e-88     1 -1641. 3289. 3302.
## # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
<p>Suppose that we like the model fit and we want to generate predictions, we would typically use the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function like so:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in predict_numeric(object = object, new_data = new_data, ...): argument "new_data" is missing, with no default</code></pre>
<p>But this produces an error when used on a parsnip model object. This is happening because we need to explicitly supply the data set that the predictions should be performed on via the <code>new_data</code> argument</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_fit</span>, new_data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 506 x 1
##    .pred
##    &lt;dbl&gt;
##  1 29.8 
##  2 25.9 
##  3 30.7 
##  4 31.8 
##  5 29.5 
##  6 29.6 
##  7 22.7 
##  8 16.4 
##  9  6.12
## 10 18.3 
## # … with 496 more rows</code></pre>
<p>Notice how the predictions are returned as a tibble. This will always be the case for parsnip models, no matter what engine is used. This is very useful since consistency allows us to combine data sets easily.</p>
<p>We can also return other types of predicts by specifying the <code>type</code> argument. Setting <code>type = "conf_int"</code> return a 95% confidence interval.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_fit</span>, new_data <span class="op">=</span> <span class="va">Boston</span>, type <span class="op">=</span> <span class="st">"conf_int"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 506 x 2
##    .pred_lower .pred_upper
##          &lt;dbl&gt;       &lt;dbl&gt;
##  1       29.0        30.6 
##  2       25.3        26.5 
##  3       29.9        31.6 
##  4       30.8        32.7 
##  5       28.7        30.3 
##  6       28.8        30.4 
##  7       22.2        23.3 
##  8       15.6        17.1 
##  9        4.70        7.54
## 10       17.7        18.9 
## # … with 496 more rows</code></pre>
<div class="infobox">
<p>
Not all engines can return all types of predictions.
</p>
</div>
<p>If you want to evaluate the performance of a model, you might want to compare the observed value and the predicted value for a data set. You</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bind_cols</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_fit</span>, new_data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span>,
  <span class="va">Boston</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">medv</span>, <span class="va">.pred</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 506 x 2
##     medv .pred
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  24   29.8 
##  2  21.6 25.9 
##  3  34.7 30.7 
##  4  33.4 31.8 
##  5  36.2 29.5 
##  6  28.7 29.6 
##  7  22.9 22.7 
##  8  27.1 16.4 
##  9  16.5  6.12
## 10  18.9 18.3 
## # … with 496 more rows</code></pre>
<p>You can get the same results using the <code>augment()</code> function to same you a little bit of typing</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">lm_fit</span>, new_data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">medv</span>, <span class="va">.pred</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 506 x 2
##     medv .pred
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  24   29.8 
##  2  21.6 25.9 
##  3  34.7 30.7 
##  4  33.4 31.8 
##  5  36.2 29.5 
##  6  28.7 29.6 
##  7  22.9 22.7 
##  8  27.1 16.4 
##  9  16.5  6.12
## 10  18.9 18.3 
## # … with 496 more rows</code></pre>
</div>
<div id="multiple-linear-regression" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Multiple linear regression<a class="anchor" aria-label="anchor" href="#multiple-linear-regression"><i class="fas fa-link"></i></a>
</h2>
<p>The multiple linear regression model can be fit in much the same way as the <a href="linear-regression.html#simple-linear-regression">simple linear regression</a> model. The only difference is how we specify the predictors. We are using the same formula expression <code>y ~ x</code>, but we can specify multiple values by separating them with <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>s.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit2</span> <span class="op">&lt;-</span> <span class="va">lm_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span>

<span class="va">lm_fit2</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  2ms 
## 
## Call:
## stats::lm(formula = medv ~ lstat + age, data = data)
## 
## Coefficients:
## (Intercept)        lstat          age  
##    33.22276     -1.03207      0.03454</code></pre>
<p>Everything else works the same. From extracting parameter estimates</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tidy</span><span class="op">(</span><span class="va">lm_fit2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)  33.2       0.731      45.5  2.94e-180
## 2 lstat        -1.03      0.0482    -21.4  8.42e- 73
## 3 age           0.0345    0.0122      2.83 4.91e-  3</code></pre>
<p>to predicting new values</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_fit2</span>, new_data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 506 x 1
##    .pred
##    &lt;dbl&gt;
##  1 30.3 
##  2 26.5 
##  3 31.2 
##  4 31.8 
##  5 29.6 
##  6 29.9 
##  7 22.7 
##  8 16.8 
##  9  5.79
## 10 18.5 
## # … with 496 more rows</code></pre>
<p>A shortcut when using formulas is to use the form <code>y ~ .</code> which means; set <code>y</code> as the response and set the remaining variables as predictors. This is very useful if you have a lot of variables and you don’t want to type them out.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit3</span> <span class="op">&lt;-</span> <span class="va">lm_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span>

<span class="va">lm_fit3</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  4ms 
## 
## Call:
## stats::lm(formula = medv ~ ., data = data)
## 
## Coefficients:
## (Intercept)         crim           zn        indus         chas          nox  
##   3.646e+01   -1.080e-01    4.642e-02    2.056e-02    2.687e+00   -1.777e+01  
##          rm          age          dis          rad          tax      ptratio  
##   3.810e+00    6.922e-04   -1.476e+00    3.060e-01   -1.233e-02   -9.527e-01  
##       black        lstat  
##   9.312e-03   -5.248e-01</code></pre>
<p>For more formula syntax look at <code><a href="https://rdrr.io/r/stats/formula.html">?formula</a></code>.</p>
</div>
<div id="interaction-terms" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Interaction terms<a class="anchor" aria-label="anchor" href="#interaction-terms"><i class="fas fa-link"></i></a>
</h2>
<p>Adding interaction terms are quite easy to do using formula expressions. However, the syntax used to describe them isn’t accepted by all engines so we will go over how to include interaction terms using recipes as well.</p>
<p>There are two ways on including an interaction term; <code>x:y</code> and <code>x * y</code></p>
<ul>
<li>
<code>x:y</code> will include the interaction between <code>x</code> and <code>y</code>,</li>
<li>
<code>x * y</code> will include the interaction between <code>x</code> and <code>y</code>, <code>x</code>, and <code>y</code>, e.i. it is short for <code>x:y + x + y</code>.</li>
</ul>
<p>with that out of the way let expand <code>lm_fit2</code> by adding an interaction term</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fit4</span> <span class="op">&lt;-</span> <span class="va">lm_spec</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span> <span class="op">*</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span>

<span class="va">lm_fit4</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  1ms 
## 
## Call:
## stats::lm(formula = medv ~ lstat * age, data = data)
## 
## Coefficients:
## (Intercept)        lstat          age    lstat:age  
##  36.0885359   -1.3921168   -0.0007209    0.0041560</code></pre>
<p>note that the interaction term is named <code>lstat:age</code>.</p>
<p>Sometimes we want to perform transformations, and we want those transformations to be applied, as part of the model fit as a pre-processing step. We will use the recipes package for this task.</p>
<p>We use the <code>step_interact()</code> to specify the interaction term. Next, we create a workflow object to combine the linear regression model specification <code>lm_spec</code> with the pre-processing specification <code>rec_spec_interact</code> which can then be fitted much like a parsnip model specification.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_spec_interact</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="va">lstat</span><span class="op">:</span><span class="va">age</span><span class="op">)</span>

<span class="va">lm_wf_interact</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_spec</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_spec_interact</span><span class="op">)</span>

<span class="va">lm_wf_interact</span> <span class="op">%&gt;%</span> <span class="fu">fit</span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span></code></pre></div>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: linear_reg()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 1 Recipe Step
## 
## • step_interact()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Coefficients:
## (Intercept)        lstat          age  lstat_x_age  
##  36.0885359   -1.3921168   -0.0007209    0.0041560</code></pre>
<p>Notice that since we specified the variables in the recipe we don’t need to specify them when fitting the workflow object. Furthermore, take note of the name of the interaction term. <code>step_interact()</code> tries to avoid special characters in variables.</p>
</div>
<div id="non-linear-transformations-of-the-predictors" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Non-linear transformations of the predictors<a class="anchor" aria-label="anchor" href="#non-linear-transformations-of-the-predictors"><i class="fas fa-link"></i></a>
</h2>
<p>Much like we could use recipes to create interaction terms between values are we able to apply transformations to individual variables as well. If you are familiar with the dplyr package then you know how to <code>mutate()</code> which works in much the same way using <code>step_mutate()</code>.</p>
<p>You would want to keep as much of the pre-processing inside recipes such that the transformation will be applied consistently to new data.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_spec_pow2</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_mutate</span><span class="op">(</span>lstat2 <span class="op">=</span> <span class="va">lstat</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">lm_wf_pow2</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_spec</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_spec_pow2</span><span class="op">)</span>

<span class="va">lm_wf_pow2</span> <span class="op">%&gt;%</span> <span class="fu">fit</span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span></code></pre></div>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: linear_reg()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 1 Recipe Step
## 
## • step_mutate()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Coefficients:
## (Intercept)        lstat       lstat2  
##    42.86201     -2.33282      0.04355</code></pre>
<p>you don’t have to hand-craft every type of linear transformation since recipes have a bunch created already <a href="https://recipes.tidymodels.org/reference/index.html#section-step-functions-individual-transformations">here</a> such as <code>step_log()</code> to take logarithms of variables.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_spec_log</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">lstat</span>, data <span class="op">=</span> <span class="va">Boston</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_log</span><span class="op">(</span><span class="va">lstat</span><span class="op">)</span>

<span class="va">lm_wf_log</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_spec</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_spec_log</span><span class="op">)</span>

<span class="va">lm_wf_log</span> <span class="op">%&gt;%</span> <span class="fu">fit</span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span></code></pre></div>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: linear_reg()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 1 Recipe Step
## 
## • step_log()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Coefficients:
## (Intercept)        lstat  
##       52.12       -12.48</code></pre>
</div>
<div id="qualitative-predictors" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Qualitative predictors<a class="anchor" aria-label="anchor" href="#qualitative-predictors"><i class="fas fa-link"></i></a>
</h2>
<p>We will now turn our attention to the <code>Carseats</code> data set. We will attempt to predict <code>Sales</code> of child car seats in 400 locations based on a number of predictors. One of these variables is <code>ShelveLoc</code> which is a qualitative predictor that indicates the quality of the shelving location. <code>ShelveLoc</code> takes on three possible values</p>
<ul>
<li>Bad</li>
<li>Medium</li>
<li>Good</li>
</ul>
<p>If you pass such a variable to <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> it will read it and generate dummy variables automatically using the following convention.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Carseats</span> <span class="op">%&gt;%</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">ShelveLoc</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##        Good Medium
## Bad       0      0
## Good      1      0
## Medium    0      1</code></pre>
<p>So we have no problems including qualitative predictors when using <code>lm</code> as the engine.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">Sales</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Income</span><span class="op">:</span><span class="va">Advertising</span> <span class="op">+</span> <span class="va">Price</span><span class="op">:</span><span class="va">Age</span>, data <span class="op">=</span> <span class="va">Carseats</span><span class="op">)</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  4ms 
## 
## Call:
## stats::lm(formula = Sales ~ . + Income:Advertising + Price:Age, 
##     data = data)
## 
## Coefficients:
##        (Intercept)           CompPrice              Income         Advertising  
##          6.5755654           0.0929371           0.0108940           0.0702462  
##         Population               Price       ShelveLocGood     ShelveLocMedium  
##          0.0001592          -0.1008064           4.8486762           1.9532620  
##                Age           Education            UrbanYes               USYes  
##         -0.0579466          -0.0208525           0.1401597          -0.1575571  
## Income:Advertising           Price:Age  
##          0.0007510           0.0001068</code></pre>
<p>however, as with so many things, we can not always guarantee that the underlying engine knows how to deal with qualitative variables. recipes can be used to handle this as well. The <code>step_dummy()</code> will perform the same transformation of turning 1 qualitative with <code>C</code> levels into <code>C-1</code> indicator variables.
While this might seem unnecessary right now, some of the engines, later on, do not handle qualitative variables and this step would be necessary. We are also using the <code>all_nominal_predictors()</code> selector to select all character and factor predictor variables. This allows us to select by type rather than having to type out the names.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_spec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">Sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">Carseats</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="va">Income</span><span class="op">:</span><span class="va">Advertising</span> <span class="op">+</span> <span class="va">Price</span><span class="op">:</span><span class="va">Age</span><span class="op">)</span>

<span class="va">lm_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_spec</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_spec</span><span class="op">)</span>

<span class="va">lm_wf</span> <span class="op">%&gt;%</span> <span class="fu">fit</span><span class="op">(</span><span class="va">Carseats</span><span class="op">)</span></code></pre></div>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: linear_reg()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 2 Recipe Steps
## 
## • step_dummy()
## • step_interact()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Coefficients:
##          (Intercept)             CompPrice                Income  
##            6.5755654             0.0929371             0.0108940  
##          Advertising            Population                 Price  
##            0.0702462             0.0001592            -0.1008064  
##                  Age             Education        ShelveLoc_Good  
##           -0.0579466            -0.0208525             4.8486762  
##     ShelveLoc_Medium             Urban_Yes                US_Yes  
##            1.9532620             0.1401597            -0.1575571  
## Income_x_Advertising           Price_x_Age  
##            0.0007510             0.0001068</code></pre>
</div>
<div id="writing-functions" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Writing functions<a class="anchor" aria-label="anchor" href="#writing-functions"><i class="fas fa-link"></i></a>
</h2>
<p>This book will not talk about how to write functions in R. If you still wants to know how to write functions we recommend the <a href="https://r4ds.had.co.nz/functions.html">functions</a> of R for Data Science.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="statistical-learning.html"><span class="header-section-number">2</span> Statistical learning</a></div>
<div class="next"><a href="classification.html"><span class="header-section-number">4</span> Classification</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#linear-regression"><span class="header-section-number">3</span> Linear Regression</a></li>
<li><a class="nav-link" href="#libraries"><span class="header-section-number">3.1</span> Libraries</a></li>
<li><a class="nav-link" href="#simple-linear-regression"><span class="header-section-number">3.2</span> Simple linear regression</a></li>
<li><a class="nav-link" href="#multiple-linear-regression"><span class="header-section-number">3.3</span> Multiple linear regression</a></li>
<li><a class="nav-link" href="#interaction-terms"><span class="header-section-number">3.4</span> Interaction terms</a></li>
<li><a class="nav-link" href="#non-linear-transformations-of-the-predictors"><span class="header-section-number">3.5</span> Non-linear transformations of the predictors</a></li>
<li><a class="nav-link" href="#qualitative-predictors"><span class="header-section-number">3.6</span> Qualitative predictors</a></li>
<li><a class="nav-link" href="#writing-functions"><span class="header-section-number">3.7</span> Writing functions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ISLR tidymodels Labs</strong>" was written by Emil Hvitfeldt. It was last built on 2021-06-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
