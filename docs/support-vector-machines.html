<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Support Vector Machines | ISLR tidymodels Labs</title>
<meta name="author" content="Emil Hvitfeldt">
<meta name="description" content="This lab will take a look at support vector machines, in doing so we will explore how changing the hyperparameters can help improve performance. This chapter will use parsnip for model fitting and...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 9 Support Vector Machines | ISLR tidymodels Labs">
<meta property="og:type" content="book">
<meta property="og:description" content="This lab will take a look at support vector machines, in doing so we will explore how changing the hyperparameters can help improve performance. This chapter will use parsnip for model fitting and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Support Vector Machines | ISLR tidymodels Labs">
<meta name="twitter:description" content="This lab will take a look at support vector machines, in doing so we will explore how changing the hyperparameters can help improve performance. This chapter will use parsnip for model fitting and...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ISLR tidymodels Labs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="statistical-learning.html"><span class="header-section-number">2</span> Statistical learning</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">3</span> Linear Regression</a></li>
<li><a class="" href="classification.html"><span class="header-section-number">4</span> Classification</a></li>
<li><a class="" href="resampling-methods.html"><span class="header-section-number">5</span> Resampling Methods</a></li>
<li><a class="" href="linear-model-selection-and-regularization.html"><span class="header-section-number">6</span> Linear Model Selection and Regularization</a></li>
<li><a class="" href="moving-beyond-linearity.html"><span class="header-section-number">7</span> Moving Beyond Linearity</a></li>
<li><a class="" href="tree-based-methods.html"><span class="header-section-number">8</span> Tree-Based Methods</a></li>
<li><a class="active" href="support-vector-machines.html"><span class="header-section-number">9</span> Support Vector Machines</a></li>
<li><a class="" href="deep-learning.html"><span class="header-section-number">10</span> Deep learning</a></li>
<li><a class="" href="survival-analysis-and-censored-data.html"><span class="header-section-number">11</span> Survival Analysis and Censored Data</a></li>
<li><a class="" href="unsupervised-learning.html"><span class="header-section-number">12</span> Unsupervised Learning</a></li>
<li><a class="" href="multiple-testing.html"><span class="header-section-number">13</span> Multiple Testing</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/EmilHvitfeldt/ISLR-tidymodels-labs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="support-vector-machines" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Support Vector Machines<a class="anchor" aria-label="anchor" href="#support-vector-machines"><i class="fas fa-link"></i></a>
</h1>
<p>This lab will take a look at support vector machines, in doing so we will explore how changing the hyperparameters can help improve performance.
This chapter will use <a href="https://www.tidymodels.org/start/models/">parsnip</a> for model fitting and <a href="https://www.tidymodels.org/start/recipes/">recipes and workflows</a> to perform the transformations, and <a href="https://www.tidymodels.org/start/tuning/">tune and dials</a> to tune the hyperparameters of the model.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR</a></span><span class="op">)</span></code></pre></div>
<div id="support-vector-classifier" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Support Vector Classifier<a class="anchor" aria-label="anchor" href="#support-vector-classifier"><i class="fas fa-link"></i></a>
</h2>
<p>Let us start by creating a synthetic data set. We will use some normally distributed data with an added offset to create 2 separate classes.</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,
  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,
  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x1</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x1</span><span class="op">)</span>,
         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x2</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>PLotting it shows that we are having two slightly overlapping classes</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">sim_data</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, color <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>We can then create a linear SVM specification by setting <code>degree = 1</code> in a polynomial SVM model. We furthermore set <code>scaled = FALSE</code> in <code>set_engine()</code> to have the engine scale the data for us. Once we get to it later we can be performing this scaling in a recipe instead.</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_linear_spec</span> <span class="op">&lt;-</span> <span class="fu">svm_poly</span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span>, scaled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Taking the specification, we can add a specific <code>cost</code> of 10 before fitting the model to the data. Using <code>set_args()</code> allows us to set the <code>cost</code> argument without modifying the model specification.</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_linear_fit</span> <span class="op">&lt;-</span> <span class="va">svm_linear_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_args</span><span class="op">(</span>cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">sim_data</span><span class="op">)</span>

<span class="va">svm_linear_fit</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  776ms 
## Support Vector Machine object of class "ksvm" 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 10 
## 
## Polynomial kernel function. 
##  Hyperparameters : degree =  1  scale =  1  offset =  1 
## 
## Number of Support Vectors : 17 
## 
## Objective Function Value : -152.0188 
## Training error : 0.125 
## Probability model included.</code></pre>
<p>The <code>kernlab</code> models can be visualized using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function if you load the <code>kernlab</code> package.</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span>
<span class="va">svm_linear_fit</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<p>what if we instead used a smaller value of the <code>cost</code> parameter?</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_linear_fit</span> <span class="op">&lt;-</span> <span class="va">svm_linear_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_args</span><span class="op">(</span>cost <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">sim_data</span><span class="op">)</span>

<span class="va">svm_linear_fit</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  28ms 
## Support Vector Machine object of class "ksvm" 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 0.1 
## 
## Polynomial kernel function. 
##  Hyperparameters : degree =  1  scale =  1  offset =  1 
## 
## Number of Support Vectors : 25 
## 
## Objective Function Value : -2.0376 
## Training error : 0.15 
## Probability model included.</code></pre>
<p>Now that a smaller value of the cost parameter is being used, we obtain a larger number of support vectors, because the margin is now wider.</p>
<p>Let us set up a <code>tune_grid()</code> section to find the value of <code>cost</code> that leads to the highest accuracy for the SVM model.</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_linear_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">svm_linear_spec</span> <span class="op">%&gt;%</span> <span class="fu">set_args</span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_formula</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">sim_data_fold</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">sim_data</span>, strata <span class="op">=</span> <span class="va">y</span><span class="op">)</span>

<span class="va">param_grid</span> <span class="op">&lt;-</span> <span class="fu">grid_regular</span><span class="op">(</span><span class="fu">cost</span><span class="op">(</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">tune_res</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span>
  <span class="va">svm_linear_wf</span>, 
  resamples <span class="op">=</span> <span class="va">sim_data_fold</span>, 
  grid <span class="op">=</span> <span class="va">param_grid</span>
<span class="op">)</span>

<span class="fu">autoplot</span><span class="op">(</span><span class="va">tune_res</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>using the <code>tune_res</code> object and <code>select_best()</code> function allows us to find the value of <code>cost</code> that gives the best cross-validated accuracy. Finalize the workflow with <code>finalize_workflow()</code> and fit the new workflow on the data set.</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_cost</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">tune_res</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span>

<span class="va">svm_linear_final</span> <span class="op">&lt;-</span> <span class="fu">finalize_workflow</span><span class="op">(</span><span class="va">svm_linear_wf</span>, <span class="va">best_cost</span><span class="op">)</span>

<span class="va">svm_linear_fit</span> <span class="op">&lt;-</span> <span class="va">svm_linear_final</span> <span class="op">%&gt;%</span> <span class="fu">fit</span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></code></pre></div>
<p>We can now generate a different data set to act as the test data set. We will make sure that it is generated using the same model but with a different seed.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">sim_data_test</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,
  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,
  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x1</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x1</span><span class="op">)</span>,
         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x2</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>and accessing the model on this testing data set shows us that the model still performs very well.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">svm_linear_fit</span>, new_data <span class="op">=</span> <span class="va">sim_data_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></code></pre></div>
<pre><code>##           Truth
## Prediction -1 1
##         -1  8 3
##         1   2 7</code></pre>
</div>
<div id="support-vector-machine" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Support Vector Machine<a class="anchor" aria-label="anchor" href="#support-vector-machine"><i class="fas fa-link"></i></a>
</h2>
<p>We will now see how we can fit an SVM using a non-linear kernel. Let us start by generating some data, but this time generate with a non-linear class boundary.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">sim_data2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">sim_data2</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, color <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<p>We will try an SVM with a radial basis function. Such a kernel would allow us to capture the non-linearity in our data.</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_rbf_spec</span> <span class="op">&lt;-</span> <span class="fu">svm_rbf</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></code></pre></div>
<p>fitting the model</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_rbf_fit</span> <span class="op">&lt;-</span> <span class="va">svm_rbf_spec</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">sim_data2</span><span class="op">)</span></code></pre></div>
<p>and plotting reveals that the model was able o separate the two classes, even though they were non-linearly separated.</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_rbf_fit</span> <span class="op">%&gt;%</span>
  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-16-1.png" width="672"></div>
<p>But let us see how well this model generalizes to new data from the same generating process.</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">sim_data2_test</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>And it works well!</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">svm_rbf_fit</span>, new_data <span class="op">=</span> <span class="va">sim_data2_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></code></pre></div>
<pre><code>##           Truth
## Prediction   1   2
##          1 137   7
##          2  13  43</code></pre>
</div>
<div id="roc-curves" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> ROC Curves<a class="anchor" aria-label="anchor" href="#roc-curves"><i class="fas fa-link"></i></a>
</h2>
<p>ROC curves can easily be created using the <code>roc_curve()</code> from the yardstick package. We use this function much the same way as we have done using the <code>accuracy()</code> function, but the main difference is that we pass the predicted class probability to <code>estimate</code> instead of passing the predicted class.</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">svm_rbf_fit</span>, new_data <span class="op">=</span> <span class="va">sim_data2_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 202 × 3
##    .threshold specificity sensitivity
##         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1   -Inf            0          1    
##  2      0.104        0          1    
##  3      0.113        0.02       1    
##  4      0.114        0.04       1    
##  5      0.115        0.06       1    
##  6      0.117        0.08       1    
##  7      0.118        0.1        1    
##  8      0.119        0.12       1    
##  9      0.124        0.14       1    
## 10      0.124        0.14       0.993
## # … with 192 more rows</code></pre>
<p>This produces the different values of <code>specificity</code> and <code>sensitivity</code> for each threshold. We can get a quick visualization by passing the results of <code>roc_curve()</code> into <code>autoplot()</code></p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">svm_rbf_fit</span>, new_data <span class="op">=</span> <span class="va">sim_data2_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">autoplot</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="09-support-vector-machines_files/figure-html/unnamed-chunk-20-1.png" width="672"></div>
<p>A common metric is t calculate the area under this curve. This can be done using the <code>roc_auc()</code> function (<code>_auc</code> stands for <strong>a</strong>rea <strong>u</strong>nder <strong>c</strong>urve).</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">svm_rbf_fit</span>, new_data <span class="op">=</span> <span class="va">sim_data2_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 roc_auc binary         0.925</code></pre>
</div>
<div id="application-to-gene-expression-data" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Application to Gene Expression Data<a class="anchor" aria-label="anchor" href="#application-to-gene-expression-data"><i class="fas fa-link"></i></a>
</h2>
<p>We now examine the Khan data set, which consists of several tissue samples corresponding to four distinct types of small round blue cell tumors. For each tissue sample, gene expression measurements are available. The data set comes in the <code>Khan</code> list which we will wrangle a little bit to create two tibbles, 1 for the training data and 1 for the testing data.</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Khan_train</span> <span class="op">&lt;-</span> <span class="fu">bind_cols</span><span class="op">(</span>
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Khan</span><span class="op">$</span><span class="va">ytrain</span><span class="op">)</span>,
  <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Khan</span><span class="op">$</span><span class="va">xtrain</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Khan_test</span> <span class="op">&lt;-</span> <span class="fu">bind_cols</span><span class="op">(</span>
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Khan</span><span class="op">$</span><span class="va">ytest</span><span class="op">)</span>,
  <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Khan</span><span class="op">$</span><span class="va">xtest</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>looking at the dimensions of the training data reveals that we have 63 observations with 20308 gene expression measurements.</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">Khan_train</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]   63 2309</code></pre>
<p>There is a very large number of predictors compared to the number of rows. This indicates that a linear kernel as the added flexibility we would get from a polynomial or radial kernel is unnecessary.</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">khan_fit</span> <span class="op">&lt;-</span> <span class="va">svm_linear_spec</span> <span class="op">%&gt;%</span>
  <span class="fu">set_args</span><span class="op">(</span>cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">fit</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">Khan_train</span><span class="op">)</span></code></pre></div>
<p>Let us take a look at the training confusion matrix. And look, we get a perfect confusion matrix. We are getting this because the hyperplane was able to fully separate the classes.</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">khan_fit</span>, new_data <span class="op">=</span> <span class="va">Khan_train</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></code></pre></div>
<pre><code>##           Truth
## Prediction  1  2  3  4
##          1  8  0  0  0
##          2  0 23  0  0
##          3  0  0 12  0
##          4  0  0  0 20</code></pre>
<p>But remember we don’t measure the performance by how well it performs on the training data set. We measure the performance of a model on how well it performs on the testing data set, so let us look at the testing confusion matrix</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">khan_fit</span>, new_data <span class="op">=</span> <span class="va">Khan_test</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">y</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></code></pre></div>
<pre><code>##           Truth
## Prediction 1 2 3 4
##          1 3 0 0 0
##          2 0 6 2 0
##          3 0 0 4 0
##          4 0 0 0 5</code></pre>
<p>And it performs fairly well. A couple of misclassification but nothing too bad.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tree-based-methods.html"><span class="header-section-number">8</span> Tree-Based Methods</a></div>
<div class="next"><a href="deep-learning.html"><span class="header-section-number">10</span> Deep learning</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#support-vector-machines"><span class="header-section-number">9</span> Support Vector Machines</a></li>
<li><a class="nav-link" href="#support-vector-classifier"><span class="header-section-number">9.1</span> Support Vector Classifier</a></li>
<li><a class="nav-link" href="#support-vector-machine"><span class="header-section-number">9.2</span> Support Vector Machine</a></li>
<li><a class="nav-link" href="#roc-curves"><span class="header-section-number">9.3</span> ROC Curves</a></li>
<li><a class="nav-link" href="#application-to-gene-expression-data"><span class="header-section-number">9.4</span> Application to Gene Expression Data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/EmilHvitfeldt/ISLR-tidymodels-labs/blob/master/09-support-vector-machines.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/EmilHvitfeldt/ISLR-tidymodels-labs/edit/master/09-support-vector-machines.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ISLR tidymodels Labs</strong>" was written by Emil Hvitfeldt. It was last built on 2021-10-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
